#!/bin/sh

# ===========================================
# Branch Name Validation
# Format: <type>/<scope-or-desc>
# Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert
# Example: feat/header-ui, fix/login-bug
# ===========================================

BRANCH=$(git rev-parse --abbrev-ref HEAD)

# Cho phép các branch đặc biệt
if [ "$BRANCH" = "main" ] || [ "$BRANCH" = "master" ] || [ "$BRANCH" = "develop" ] || [ "$BRANCH" = "HEAD" ]; then
  # Branch cho phép, tiếp tục
  :
else
  # Kiểm tra format branch name
  VALID_TYPES="feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert|hotfix|release"
  PATTERN="^($VALID_TYPES)/[a-z0-9._-]+$"
  
  if ! echo "$BRANCH" | grep -qE "$PATTERN"; then
    echo ""
    echo "❌ Invalid branch name: $BRANCH"
    echo ""
    echo "Branch name must follow the format: <type>/<scope-or-desc>"
    echo ""
    echo "Valid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert, hotfix, release"
    echo ""
    echo "Examples:"
    echo "  ✅ feat/header-ui"
    echo "  ✅ fix/login-bug"
    echo "  ✅ refactor/api-client"
    echo "  ✅ docs/readme-update"
    echo ""
    echo "  ❌ feature/header-ui  (use 'feat' not 'feature')"
    echo "  ❌ HeaderUI           (missing type/)"
    echo "  ❌ feat/Header_UI     (use lowercase)"
    echo ""
    exit 1
  fi
fi

# ===========================================
# Lint Staged Files
# ===========================================
pnpm exec lint-staged
